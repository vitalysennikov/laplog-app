# Задание 2: Расширение функционала приложения

## Название приложения
**LapLog Free**

---

## 1. Сохранение настроек ✅ ВЫПОЛНЕНО

### 1.1. Show milliseconds ✅
- Запоминать последний выбранный вариант (включено/выключено)
- Сохранять в SharedPreferences
- Восстанавливать при запуске приложения
- **Реализовано**: IconToggleButton с иконкой Timer и подписью "ms"

### 1.2. Keep screen on ✅
- Добавить переключатель: держать экран включенным во время работы секундомера
- Запоминать выбранный вариант
- Сохранять в SharedPreferences
- Восстанавливать при запуске приложения
- **Реализовано**: IconToggleButton с иконкой PhoneAndroid и подписью "Screen"

### 1.3. Lock orientation ✅ ДОБАВЛЕНО
- Блокировка ориентации экрана в портретном режиме
- Переключатель с сохранением в SharedPreferences
- **Реализовано**: IconToggleButton с иконкой ScreenLockPortrait и подписью "Lock"

---

## 2. Изменения UI ✅ ВЫПОЛНЕНО

### 2.1. Кнопки управления ✅
Убрать текстовые подписи с кнопок, оставить только иконки (32dp):

#### Reset (Сброс)
- **Иконка**: `Icons.Default.Refresh`
- **Внешний вид**: ↻ Круговая стрелка (циклическая стрелка)
- **Цвет**: Тональная кнопка (FilledTonalButton)

#### Start (Старт)
- **Иконка**: `Icons.Default.PlayArrow`
- **Внешний вид**: ▶ Треугольник вправо
- **Цвет**: Основная кнопка (Button)

#### Pause (Пауза)
- **Иконка**: `Icons.Default.Pause`
- **Внешний вид**: ⏸ Две вертикальные полоски
- **Цвет**: Основная кнопка (Button)

#### Resume (Продолжить)
- **Иконка**: `Icons.Default.PlayArrow`
- **Внешний вид**: ▶ Треугольник вправо (такая же как Start)
- **Цвет**: Основная кнопка (Button)

#### Lap (Промежуточная отметка)
- **Иконка**: `Icons.Default.Flag` или `Icons.Outlined.Flag`
- **Внешний вид**: ⚑ Флажок
- **Варианты**:
  - `Icons.Default.Flag` - заполненный флажок
  - `Icons.Outlined.Flag` - контурный флажок (рекомендуется для лучшей видимости)
- **Цвет**: Тональная кнопка (FilledTonalButton)

### 2.2. Промежуточные отметки (Lap marks) ✅
- Сделать более узкими (компактными)
- Не делать "Time" над "Duration"
- Разместить информацию посредине для компактности
- Убрать лишние отступы
- **Реализовано**: Компактный однострочный layout с моноширинным шрифтом

### 2.3. Моноширинный шрифт ✅ ДОБАВЛЕНО
- Время секундомера отображается моноширинным шрифтом (FontFamily.Monospace, 56sp)
- Время в lap marks также моноширинное
- Цифры не "прыгают" при изменении

### 2.4. Переключатели настроек ✅ УЛУЧШЕНО
- Переключатели размещены в горизонтальный ряд
- Заменены на IconToggleButton с иконками и маленькими подписями
- Три переключателя: milliseconds, keep screen on, lock orientation

### 2.5. Название приложения ✅ УЛУЧШЕНО
- Убрана большая надпись "LapLog Free" из TopAppBar
- Добавлена маленькая надпись внизу над навигационными кнопками

---

## 3. История запусков ✅ ВЫПОЛНЕНО

### 3.1. Сохранение данных ✅
- Сохранять каждый запуск секундомера с промежуточными результатами
- Хранить в базе данных (Room Database)
- Данные не должны теряться при закрытии приложения
- **Реализовано**: SessionEntity и LapEntity с foreign key cascade delete
- **Сохранение**: При нажатии кнопки Reset

### 3.2. Отображение истории ✅
- Оформить в виде скроллируемого списка
- Новые записи добавляются вверху (обратный хронологический порядок)
- Каждый запуск содержит:
  - Дата и время начала запуска
  - Общее время выполнения
  - Список промежуточных отметок (laps)
  - Комментарий (опционально)
- **Реализовано**: Expandable Card с деталями, Bottom Navigation для переключения

### 3.3. Комментарии к запускам ✅
- **Добавление комментария**: возможность добавить текстовый комментарий к запуску
- **Выбор из ранее использованных**: выпадающий список с предыдущими комментариями
  - Примеры: "Практика", "Задержки дыхания", "Тренировка" и т.п.
- **Редактирование комментария**: возможность изменить комментарий существующего запуска
- **Автодополнение**: предлагать ранее использованные комментарии при вводе
- **Реализовано**: CommentDialog с фильтрацией suggestions, сохранение в SharedPreferences

### 3.4. Удаление записей ✅
Три варианта удаления:

1. **Удалить выбранный запуск** ✅
   - Удалить только конкретную выбранную запись
   - Запросить подтверждение перед удалением

2. **Удалить запуски ДО выбранного** ✅
   - Удалить все записи, которые были раньше (старше) выбранной
   - Включая саму выбранную запись
   - Запросить подтверждение с указанием количества удаляемых записей

3. **Удалить всю историю** ✅
   - Очистить все сохраненные записи
   - Обязательное подтверждение действия
   - Предупреждение о невозможности восстановления

### 3.5. Экспорт истории ✅
- **Выгрузка в файл**: возможность экспортировать всю историю запусков в файл
- **Форматы файла**: CSV и JSON (оба доступны)
- **Содержимое экспорта**:
  - Все запуски с датами
  - Комментарии
  - Промежуточные отметки (laps)
- **Расположение файла**: Storage Access Framework - пользователь выбирает папку
- **Название файла**: автоматическое с датой/временем (`laplog_history_2025-11-09_143022.csv`)
- **Реализовано**: Экспорт из меню History screen, оба формата работают

---

## 4. Структура данных для истории

### 4.1. Запуск (Session)
- ID записи (уникальный)
- Дата и время начала
- Дата и время окончания
- Общее время выполнения
- Комментарий (текст, nullable)
- Список промежуточных отметок (Laps)

### 4.2. Промежуточная отметка (Lap)
- ID отметки
- ID родительского запуска (foreign key)
- Номер круга
- Общее время на момент отметки
- Длительность круга

---

## 5. Будущие задачи

### 5.1. Публикация в Google Play
- Подготовка release build с подписью
- Создание описания приложения
- Подготовка скриншотов
- Публикация в Google Play Store

---

## Приоритеты реализации

1. **Этап 1**: Сохранение настроек (SharedPreferences) ✅
2. **Этап 2**: Изменение UI (иконки, компактные lap marks) ✅
3. **Этап 3**: База данных и сохранение истории ✅
4. **Этап 4**: Комментарии к запускам ✅
5. **Этап 5**: Функции удаления ✅
6. **Этап 6**: Экспорт истории в файл ✅
7. **Этап 7**: Полировка UI и тестирование ✅
8. **Этап 8**: Подготовка к публикации в Google Play ⏳

---

## Технические детали

### База данных
- **Room Database** для хранения истории
- Две таблицы: Sessions и Laps
- Связь один-ко-многим (Session → Laps)

### Настройки
- **SharedPreferences** для сохранения параметров UI
- Ключи:
  - `show_milliseconds` (Boolean)
  - `keep_screen_on` (Boolean)
  - `lock_orientation` (Boolean)
  - `used_comments` (Set<String>) - список использованных комментариев


### UI компоненты

- **Bottom Navigation** для переключения между секундомером и историей (Jetpack Compose)
- **LazyColumn** для отображения списка истории (Compose)
- **Expandable Cards** для сессий с лапами
- **CommentDialog** с автодополнением (фильтрация suggestions)
- **AlertDialog** для подтверждения операций удаления
- **IconToggleButton** для переключателей настроек
- **Monospace Font** для отображения времени (56sp для главного таймера)
